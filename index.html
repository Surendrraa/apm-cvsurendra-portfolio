<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>APM Portfolio | CV Surendra</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Babel for runtime transpilation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Unified Import Map -->
    <script type="importmap">
{
  "imports": {
    "react": "https://esm.sh/react@19.0.0",
    "react-dom": "https://esm.sh/react-dom@19.0.0",
    "react-dom/client": "https://esm.sh/react-dom@19.0.0/client",
    "react/jsx-runtime": "https://esm.sh/react@19.0.0/jsx-runtime",
    "react-dom/": "https://esm.sh/react-dom@^19.2.3/",
    "react/": "https://esm.sh/react@^19.2.3/",
    "@google/genai": "https://esm.sh/@google/genai@^1.34.0"
  }
}
</script>

    <style>
        body { margin: 0; background-color: #09090b; color: #fafafa; font-family: 'Inter', sans-serif; overflow-x: hidden; }
        ::-webkit-scrollbar { width: 8px; }
        ::-webkit-scrollbar-track { background: #09090b; }
        ::-webkit-scrollbar-thumb { background: #27272a; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #3f3f46; }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Wire Snake Animation Styles */
        @keyframes drawLine {
            from { stroke-dashoffset: 2000; }
            to { stroke-dashoffset: 0; }
        }

        @keyframes snakeFlow {
            0% { stroke-dashoffset: 100; }
            100% { stroke-dashoffset: 0; }
        }

        .wire-snake {
            stroke-dasharray: 50, 50;
            animation: snakeFlow 10s linear infinite;
        }

        .glowing-path {
            filter: drop-shadow(0 0 8px rgba(139, 92, 246, 0.5));
        }

        /* Custom Portfolio Animations */
        @keyframes textGlow {
            0%, 100% { text-shadow: 0 0 10px rgba(139, 92, 246, 0.2); opacity: 0.8; }
            50% { text-shadow: 0 0 25px rgba(139, 92, 246, 0.6); opacity: 1; }
        }

        @keyframes fadeUpReveal {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .animate-text-glow {
            animation: textGlow 3s ease-in-out infinite;
        }

        .animate-fade-up-reveal {
            animation: fadeUpReveal 1s cubic-bezier(0.16, 1, 0.3, 1) forwards;
        }
    </style>
</head>
<body>
    <div id="root">
        <div id="loading-screen" style="height: 100vh; display: flex; align-items: center; justify-content: center; background: #09090b; color: #fafafa;">
            <div style="text-align: center; padding: 20px;">
                <div id="loader-icon" style="width: 44px; height: 44px; border: 3px solid #1a1a1a; border-top-color: #8B5CF6; border-radius: 50%; animation: spin 0.8s linear infinite; margin: 0 auto 24px;"></div>
                <p id="status-text" style="font-family: 'Inter', sans-serif; font-size: 11px; font-weight: 600; letter-spacing: 0.2em; text-transform: uppercase; color: #52525b;">Warming up engine...</p>
                <div id="error-box" style="display: none; margin-top: 20px; color: #f87171; font-size: 12px; max-width: 500px; margin-left: auto; margin-right: auto; white-space: pre-wrap; font-family: monospace; background: #1a1111; padding: 16px; border-radius: 8px; border: 1px solid #442222; text-align: left;"></div>
            </div>
        </div>
    </div>

    <script type="text/javascript">
      // Ensure process.env is safely initialized before any module runs
      window.process = window.process || { env: {} };
      window.process.env = window.process.env || {};
      window.process.env.NODE_ENV = window.process.env.NODE_ENV || 'production';

      const moduleCache = new Map();
      const projectFiles = [
        'index.tsx', 'App.tsx', 'types.ts', 'constants.tsx',
        'components/Navbar.tsx', 'components/Hero.tsx', 'components/About.tsx',
        'components/Portfolio.tsx', 'components/Documentation.tsx', 'components/Experience.tsx',
        'components/Skills.tsx', 'components/Footer.tsx', 'components/PRDModal.tsx',
        'components/SectionHeading.tsx', 'components/MobileScreenRenderer.tsx',
        'components/EmailComposer.tsx', 'components/BackgroundSnake.tsx',
        'components/VibeKodesSection.tsx', 'components/ChatBot.tsx',
        'services/geminiService.ts'
      ];

      // Robust base URL detection for GitHub Pages
      const baseDir = window.location.pathname.endsWith('/') 
        ? window.location.origin + window.location.pathname 
        : window.location.origin + window.location.pathname.substring(0, window.location.pathname.lastIndexOf('/') + 1);

      function resolvePath(base, relative) {
        return new URL(relative, base).href;
      }

      function getCorrectExtension(path) {
        if (/\.(tsx|ts|js)$/.test(path)) return path;
        
        const cleanPath = path.replace(/^(\.\.\/|\.\/)+/, '');
        const match = projectFiles.find(f => {
          const fName = f.replace(/\.(tsx|ts)$/, '');
          return fName === cleanPath || fName.endsWith('/' + cleanPath);
        });

        if (match) {
          return path + (match.endsWith('.tsx') ? '.tsx' : '.ts');
        }
        return path;
      }

      async function loadModule(url) {
        const absoluteUrl = new URL(url, baseDir).href;
        if (moduleCache.has(absoluteUrl)) return moduleCache.get(absoluteUrl);

        let resolveBlob;
        const promise = new Promise(res => { resolveBlob = res; });
        moduleCache.set(absoluteUrl, promise);

        try {
          // Add cache-busting version query string
          const fetchUrl = absoluteUrl + '?v=' + Date.now();
          const response = await fetch(fetchUrl);
          
          if (!response.ok) throw new Error(`Fetch Failed: ${url} (Status: ${response.status})`);
          let code = await response.text();

          const importRegex = /(from|import)\s+['"](\.\.?\/[^'"]+)['"]/g;
          const matches = [...code.matchAll(importRegex)];
          const sortedMatches = matches.sort((a, b) => b.index - a.index);
          
          for (const match of sortedMatches) {
            const fullMatch = match[0];
            const originalPath = match[2];
            const guessedPath = getCorrectExtension(originalPath);
            const resolvedAbsolute = resolvePath(absoluteUrl, guessedPath);
            
            const blobUrl = await loadModule(resolvedAbsolute);
            const newMatch = fullMatch.replace(originalPath, blobUrl);
            code = code.substring(0, match.index) + newMatch + code.substring(match.index + fullMatch.length);
          }

          const transpiled = Babel.transform(code, {
            presets: [
              ['typescript', { isTSX: true, allExtensions: true }], 
              ['react', { runtime: 'automatic' }]
            ],
            filename: url
          }).code;

          const blob = new Blob([transpiled], { type: 'application/javascript' });
          const blobUrl = URL.createObjectURL(blob);
          resolveBlob(blobUrl);
          return blobUrl;
        } catch (err) {
          moduleCache.delete(absoluteUrl);
          throw err;
        }
      }

      (async () => {
        try {
          console.log("Initializing Portfolio Engine...");
          const entryBlobUrl = await loadModule('./index.tsx');
          const script = document.createElement('script');
          script.type = 'module';
          script.src = entryBlobUrl;
          document.head.appendChild(script);
        } catch (err) {
          const loaderIcon = document.getElementById('loader-icon');
          if (loaderIcon) loaderIcon.style.display = 'none';
          const statusText = document.getElementById('status-text');
          if (statusText) statusText.innerText = "Boot Failed";
          const errorBox = document.getElementById('error-box');
          if (errorBox) {
            errorBox.style.display = 'block';
            errorBox.innerText = `[Engine Error]: ${err.message}\n\nTrace: ${err.stack || 'No trace available'}`;
          }
          console.error("Portfolio Boot error:", err);
        }
      })();
    </script>
</body>
</html>